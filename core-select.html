
<!-- Defines element markup -->
<template>
    <p>-> <strong></strong> :)</p>
</template>
<!-- шаблон группы -->
<template id="group">

  <style type="text/css">
    .criteriaSelectorGroup {
      /*background: rgba(0,0,0,0.02);*/
      width: 95%;
      margin: 0px;
      /*padding: 14px;*/
      list-style: none;
    }
    .criteriaSelector {
      /*padding: 15px;*/
      margin-bottom: 20px;
      border-radius: 0;
      background: #f5f5f5;
      box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.16), 0 2px 2px 0 rgba(0, 0, 0, 0.12);
    }
    .mui-col-md-12 {
      width: 100%;
    }

    .mui-btn {
      -webkit-animation-duration: .1ms;
      animation-duration: .1ms;
      -webkit-animation-name: mui-node-inserted;
      animation-name: mui-node-inserted;
      font-weight: 500;
      font-size: 14px;
      line-height: 18px;
      text-transform: uppercase;
      color: rgba(0,0,0,.87);
      background-color: #FFF;
      transition: all .2s ease-in-out;
      display: inline-block;
      height: 36px;
      padding: 0 26px;
      margin-top: 6px;
      margin-bottom: 6px;
      border: none;
      border-radius: 2px;
      cursor: pointer;
      -ms-touch-action: manipulation;
      touch-action: manipulation;
      background-image: none;
      text-align: center;
      line-height: 36px;
      vertical-align: middle;
      white-space: nowrap;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      font-size: 14px;
      letter-spacing: .03em;
      position: relative;
      overflow: hidden;
    }
    .mui-btn--small {
      height: 30.6px;
      line-height: 30.6px;
      padding: 0 16px;
      font-size: 13px;
    }
    .mui-btn--primary {
      color: #FFF;
      background-color: #2196F3;
    }
    .mui-btn--primary:active, .mui-btn--primary:focus, .mui-btn--primary:hover {
      color: #FFF;
      background-color: #39a1f4;
    }
    .mui-btn:focus, .mui-btn:hover {
      box-shadow: 0 0 2px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.2);
    }
    .mui-btn--primary:active, .mui-btn--primary:focus, .mui-btn--primary:hover {
      color: #FFF;
      background-color: #39a1f4;
    }
    .mui-btn:active {
      box-shadow: 0 10px 20px rgba(0,0,0,.19),0 6px 6px rgba(0,0,0,.23);
    }
    .mui-btn:active, .mui-btn:focus, .mui-btn:hover {
      outline: 0;
      text-decoration: none;
      color: #FFF;
    }
    .criteriaSelectorGroupName{
      padding: 10px;
    }
    .criteriaSelectorGroupNameGroup{
      padding: 20px 10px;
    }
    .mui--pull-right{
      float: right!important;
    }
    .mui--pull-left{
      float: left!important;
    }
    .mui-row{
      display: block;
    }
    .criteriaSelectorItem {
        width: 96%;
        /*margin: 5px 0 0 10px;*/
        margin: 10px auto;
        line-height: normal;
        padding: 0px;
        list-style: none;
        background-color: #fff;
    }
    .criteriaSelectorItemName {
      margin-top: 7px;
    }
    .criteriaSelectorItemTemplate {
      display: none;
    }
    .criteriaSelectorGroupList{
      margin-top: 0;
      margin-bottom: 10px;
      padding: 0px;
    }

    .criteriaSelectorItemHeader:hover {
        cursor: pointer;
        transition: 0.1s;
        background: rgba(0,0,0,0.02);
        /* box-shadow: 0 3px 6px rgba(0,0,0,.16), 0 3px 6px rgba(0,0,0,.23); */
    }
    .criteriaSelectorItemHeader {
        padding: 5px 10px 10px;
        height: 2em;
    }
    .criteriaForm.hide {
        transition: 0.1s;
        display: none;
    }
    .criteriaForm {
        padding-bottom: 20px;
        transition: 0.1s;
        display: block;
    }
    .mui--z1{
      box-shadow: rgba(0, 0, 0, 0.156863) 0px 2px 2px 0px, rgba(0, 0, 0, 0.117647) 0px 0px 2px 0px;
    }

    .mui-select>select {
        -webkit-animation-duration: .1ms;
        animation-duration: .1ms;
        -webkit-animation-name: mui-node-inserted;
        animation-name: mui-node-inserted;
        display: block;
        height: 32px;
        width: 96%;
        margin: 0 2%;
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        outline: 0;
        border: none;
        border-bottom: 1px solid rgba(0,0,0,.26);
        border-radius: 0;
        box-shadow: none;
        background-color: transparent;
        background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zd…M9IjAsMCAxMCwwIDUsNiIgc3R5bGU9ImZpbGw6cmdiYSgwLDAsMCwuMjQpOyIvPjwvc3ZnPg==);
        background-repeat: no-repeat;
        background-position: right center;
        cursor: pointer;
        color: rgba(0,0,0,.87);
        font-size: 14px;
        padding: 0 25px 0 0;
    }
    .mui-select>select>option {
        font-weight: normal;
        display: block;
        padding: 0px 2px 1px;
        white-space: pre;
        min-height: 1.2em;
    }
    .mui-textfield {
        -webkit-animation-duration: .1ms;
        animation-duration: .1ms;
        -webkit-animation-name: mui-node-inserted;
        animation-name: mui-node-inserted;
        display: block;
        background-color: transparent;
        color: rgba(0,0,0,.87);
        border: none;
        border-bottom: 2px solid rgba(0,0,0,.26);
        outline: 0;
        height: 32px;
        width: 96%;
        margin: 0 2%;
        font-size: 14px;
        padding: 0;
        box-shadow: none;
        border-radius: 0;
        background-image: none;
    }
    .mui-select>select:focus {
        outline: 0;
        height: 33px;
        margin-bottom: -1px;
        border-color: #2196F3;
        border-width: 2px;
    }
    .mui-textfield>input:focus {
        height: 33px;
        margin-bottom: -1px;
    }
    .mui-textfield>input:focus, .mui-textfield>textarea:focus {
        border-color: #2196F3;
        border-width: 2px;
    }

  </style>

  <div class="criteriaSelector">
    
    <li class=" mui-col-md-12 mui-panel mui-panel-group criteriaSelectorGroup mui--z2">
      <div style="width: 100%; height: 50px;">
        <span class="criteriaSelectorGroupNameGroup mui--pull-left"> Группа </span>
        <span class="criteriaSelectorGroupName mui--pull-right">
          <button class="mui-btn mui-btn--primary mui-btn--small addCriteriaItemToGroup"> Добавить </button>
        </span>
      </div>
      <ul class="criteriaSelectorGroupList mui-row"></ul>
    </li>

    <div class="mui-select mui-col-md-12 connectionGroup mui--hide">
      <select>
        <option value="and">И</option>
        <option value="or">ИЛИ</option>
      </select>
    </div>
  </div>
</template>

<!-- шаблон критерия -->
<template id="item">
    <li class="mui--z1 criteriaSelectorItem mui-panel mui-col-md-12 ">
      <div class="criteriaSelectorItemHeader">
        <div class="criteriaSelectorItemName mui--pull-left">Критерий</div>
        <span class="criteriaSelectorItemOptions mui--pull-right">
          <!-- <i class="fa fa-sort-down"></i> -->
          <!-- <i class="fa fa-reorder criteriaMenuItem settings"></i> -->
          <div class="mui-select">
            <select class="itemSelectCondition criteriaSelectorItemCondition">
              <!-- <option value="" disabled selected>Связь</option> -->
              <option value="and">И</option>
              <option value="or">ИЛИ</option>
            </select>
          </div>

          <i class="fa fa-trash-o criteriaMenuItem remove"></i>
        </span>
        <div class="mui--clearfix"></div>
      </div>
      <div class="criteriaForm hide mui-select">
          <select name="table_name">
            <option value="554c5fc85804000014000001">Справочник</option>
            <option >Выберете журнал</option>
            <option >Выберете журнал</option>
            <option >Выберете журнал</option>
            <option >Выберете журнал</option>
          </select>

          <select name="origin_name">
            <option disabled="true">Выберете поле</option>
          </select>
          
          <select name="conditions">
            <option value="equal">Точное совпадение</option>
            <option value="not_equal">Не</option>
            <option value="regexp">Частичное совпадение</option>
            <option value="full_text">Ключевые слова</option>
          </select>
          
          <input class="mui-textfield" type="text" name="value" placeholder="Значение">
          
      </div>
    </li>
</template>

<script>
window.onload = (function(window, document, undefined) {
  var thatDoc         = document,
      thisDoc         = (thatDoc._currentScript || thatDoc.currentScript).ownerDocument,
      groupTemplate   = thisDoc.querySelector('template#group').content,
      itemTemplate    = thisDoc.querySelector('template#item').content,
      CoreSelectProto = Object.create(HTMLElement.prototype);
  
  // CoreSelectProto.select = 'World';
  
  CoreSelectProto.createdCallback = function() {
    var shadowRoot = this.createShadowRoot(),
        group      = thatDoc.importNode( groupTemplate, true );
    
    shadowRoot.appendChild(group);
    var list = shadowRoot.querySelector('.criteriaSelectorGroupList');
    

    shadowRoot.querySelector('.addCriteriaItemToGroup').addEventListener('click', function(){
      var item            = itemTemplate.cloneNode(true),
          header          = item.querySelector('.criteriaSelectorItemHeader'),
          form            = item.querySelector('.criteriaForm'),
          headerCondition = item.querySelector('select.itemSelectCondition');

      list.appendChild( item );
      
      console.log( 'h, s', form.querySelector('[name="table_name"]') );

      // $( form.querySelector('[name="table_name"]') ).select2();

      header.addEventListener('click', function(e){
        console.log('header clicked', this, e);
        form.classList.toggle( 'hide' );
      });

      headerCondition.addEventListener('click', function(e){
        
        console.log('headerCondition', this, e);
        
        e.stopPropagation();
        e.preventDefault();
        return false;

      });
    });
  };


  CoreSelectProto.attributeChangedCallback = function(attr, oldVal, newVal) {
    console.log('attr, oldVal, newVal: ',attr, oldVal, newVal);
    if (attr === 'select') {
      this.setWho(newVal);
    }
  };

  CoreSelectProto.setWho = function(val) {
    this.select = val;
    this.strong.textContent = this.select;
  };

  window.CoreSelect = thatDoc.registerElement('core-select', {
    prototype: CoreSelectProto
  });
})(window, document);
</script>